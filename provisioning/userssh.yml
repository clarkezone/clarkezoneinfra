#ansible-playbook -i ../inventory/hosts_for_monitoring.ini userssh.yml -u root --extra-vars "uusername=<USERNAME>" --extra-vars "upassword=<PASSWORD>"
---
- hosts: master
  remote_user: root
  gather_facts: false 
  tasks:
    - name: Wait 600 seconds for target connection to become reachable/usable
      ansible.builtin.wait_for_connection:
    - name: Creating user "{{ uusername }}" with admin access
      become: true
      user: 
        name: "{{ uusername }}"
        password: "{{ upassword | password_hash('sha512') }}"
        groups: adm,sudo
        shell: /bin/bash
        append: yes
    - name: Set authorized keys taken from url
      become: true
      ansible.posix.authorized_key:
        user: "{{ uusername }}"
        state: present
        key: "{{ repokeys }}"
