---
- hosts: all
  tasks:
# install kubectl
    - name: kubectl
      block:
        - name: Add an apt signing key for Kubernetes
          become: true
          apt_key:
            url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
            state: present

        - name: Adding apt repository for Kubernetes
          become: true
          apt_repository:
            repo: deb https://apt.kubernetes.io/ kubernetes-xenial main
            state: present
            filename: kubernetes.list

        - name: Install kubectl
          become: true
          apt: 
            name: kubectl
            update_cache: yes

        - name: Ensure kubectl autocomplete
          ansible.builtin.lineinfile:
            path: "{{ ansible_user_dir }}/.zshrc"
            line: 'source <(kubectl completion zsh)'
            insertafter: EOF
